<div class="modal fade" id="userLoginModal" tabindex="-1" aria-labelledby="userLoginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">
          <div class="modal-header border-secondary">
              <h5 class="modal-title" id="userLoginModalLabel">Login / Cadastro</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <form>
                  <div class="mb-3">
                      <label for="emailInput" class="form-label">Email</label>
                      <input type="email" class="form-control" id="emailInput">
                  </div>
                  <div class="mb-3">
                      <label for="passwordInput" class="form-label">Senha</label>
                      <input type="password" class="form-control" id="passwordInput">
                  </div>
                  <button type="submit" class="btn btn-danger w-100">Entrar</button>
              </form>
              <div class="text-center mt-3">
                  <a href="#" class="text-warning" data-bs-toggle="modal" data-bs-target="#userRegisterModal">
                      Não tem uma conta? Cadastre-se
                  </a>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="userRegisterModal" tabindex="-1" aria-labelledby="userRegisterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">
          <div class="modal-header border-secondary">
              <h5 class="modal-title" id="userRegisterModalLabel">Criar Nova Conta</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <form action="/register" method="POST">
                  <div class="mb-3">
                      <label for="registerNameInput" class="form-label">Nome Completo</label>
                      <input type="text" class="form-control" id="usuarioN" name="usuarioN" required>
                  </div>
                  <div class="mb-3">
                      <label for="registerEmailInput" class="form-label">Email</label>
                      <input type="email" class="form-control" id="emailN" name="emailN" required>
                  </div>
                  <div class="mb-3">
                      <label for="registerPasswordInput" class="form-label">Senha</label>
                      <input type="password" class="form-control" id="senhaN" name="senhaN" required>
                  </div>
                  <div class="mb-3">
                      <label for="confirmPasswordInput" class="form-label">Confirmar Senha</label>
                      <input type="password" class="form-control" id="confirmPasswordInput" name="confirmPassword" required>
                  </div>
                  <button type="submit" class="btn btn-danger w-100">Cadastrar</button>
              </form>
              <div class="text-center mt-3">
                  <a href="#" class="text-warning" data-bs-toggle="modal" data-bs-target="#userLoginModal">
                      Já tem uma conta? Faça login
                  </a>
              </div>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="addGameModal" tabindex="-1" aria-labelledby="addGameModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">
          <div class="modal-header border-secondary">
              <h5 class="modal-title" id="addGameModalLabel">Adicionar Novo Jogo</h5>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <form id="addGameForm" action="/admin/add-game" method="POST" enctype="multipart/form-data">
                  <div class="mb-3">
                      <label for="gameName" class="form-label">Nome do Jogo</label>
                      <input type="text" class="form-control" id="Name" name="gameName" placeholder="Ex: Catan" required>
                  </div>
                  <div class="mb-3">
                      <label for="gameCategory" class="form-label">Categoria</label>
                      <input type="text" class="form-control" id="Category" name="gameCategory" placeholder="Ex: Tabuleiro" required>
                  </div>
                  <div class="mb-3">
                    <label for="gameCategory" class="form-label">descrição</label>
                    <input type="text" class="form-control" id="Category" name="gameDesc" placeholder="Qual a descrição" required>
                </div>
                  <div class="row">
                      <div class="col-md-6 mb-3">
                          <label for="gameStock" class="form-label">Estoque</label>
                          <input type="number" class="form-control" id="Stock" name="gameStock" placeholder="Ex: 15" min="0" required>
                      </div>
                      <div class="col-md-6 mb-3">
                          <label for="gamePrice" class="form-label">Preço (R$)</label>
                          <input type="number" class="form-control" id="Price" name="gamePrice" placeholder="Ex: 299.90" min="0" step="0.01" required>
                      </div>
                  </div>
                  <div class="mb-3">
                      <label for="gameImage" class="form-label">Foto do Jogo</label>
                      <input type="file" class="form-control bg-secondary text-white" id="gameImageFile" name="gameImage" accept="image/*">
                  </div>
                  <div class="modal-footer border-top-0 d-flex justify-content-end pt-0 px-0">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                      <button type="submit" class="btn btn-danger">Salvar Jogo</button>
                  </div>
              </form>
          </div>
      </div>
  </div>
</div>

<div class="modal fade" id="registerRentalModal" tabindex="-1" aria-labelledby="registerRentalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="registerRentalModalLabel">Registrar Novo Aluguel</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerRentalForm" action="/admin/rentals/create" method="POST">
                    <div class="mb-3">
                        <label for="rentalUser" class="form-label">Cliente</label>
                        <select class="form-select" id="rentalUser" name="userId" required>
                            <option selected disabled value="">Selecione um cliente...</option>
                            <option value="1">Rafael Consales</option>                       
                            <option value="2">Maria Silva</option>
                            <option value="3">João Pereira</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="rentalGame" class="form-label">Jogo</label>
                        <select class="form-select" id="rentalGame" name="gameId" required>
                            <option selected disabled value="">Selecione um jogo disponível...</option>
                            <option value="101">Catan (Aluguel: R$ 20,00)</option>
                            <option value="102">Ticket to Ride (Aluguel: R$ 25,00)</option>
                            <option value="103">D&D Starter Set (Aluguel: R$ 15,00)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label d-block">Duração do Aluguel</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="rentalDuration" id="duration1" value="1" checked>
                            <label class="form-check-label" for="duration1">1 Dia</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="rentalDuration" id="duration3" value="3">
                            <label class="form-check-label" for="duration3">3 Dias</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="rentalDuration" id="duration5" value="5">
                            <label class="form-check-label" for="duration5">5 Dias</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="rentalDate" class="form-label">Data de Início</label>
                        <input type="date" class="form-control" id="rentalDate" name="startDate" required>
                    </div>
                    <div class="modal-footer border-top-0 d-flex justify-content-end pt-0 px-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-danger">Registrar Aluguel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="registerSaleModal" tabindex="-1" aria-labelledby="registerSaleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="registerSaleModalLabel">Registrar Nova Venda</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerSaleForm" action="/admin/sales/create" method="POST">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="saleClient" class="form-label">Cliente</label>
                            <select class="form-select" id="saleClient" name="userId" required>
                                <option selected disabled value="">Selecione um cliente...</option>                              
                                <option value="1">Lucas Silva</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="saleDate" class="form-label">Data da Venda</label>
                            <input type="date" class="form-control" id="saleDate" name="saleDate" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="saleProducts" class="form-label">Produtos</label>
                        <select class="form-select" id="saleProducts" name="productIds" multiple required size="4">
                            <option value="101">Catan (R$ 299,90)</option>
                            <option value="102">Ticket to Ride (R$ 349,90)</option>
                            <option value="103">D&D Starter Set (R$ 249,90)</option>
                            <option value="104">Magic: TG Arena Kit (R$ 89,90)</option>
                        </select>
                        <div class="form-text">Para selecionar múltiplos itens, segure Ctrl (ou Cmd no Mac).</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="paymentMethod" class="form-label">Método de Pagamento</label>
                            <select class="form-select" id="paymentMethod" name="paymentMethod" required>
                                <option value="credit_card">Cartão de Crédito</option>
                                <option value="debit_card">Cartão de Débito</option>
                                <option value="pix">PIX</option>
                                <option value="cash">Dinheiro</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                             <label for="saleStatus" class="form-label">Status da Venda</label>
                            <select class="form-select" id="saleStatus" name="status" required>
                                <option value="completed">Concluída</option>
                                <option value="pending">Pendente</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="text-end border-top pt-3 mt-3">
                        <h5 class="text-muted">Total Estimado</h5>
                        <h3><span class="price-highlight">R$ 0,00</span></h3>
                    </div>

                    <div class="modal-footer border-top-0 d-flex justify-content-end pt-3 px-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-danger">Registrar Venda</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="shoppingCartOffcanvas" aria-labelledby="shoppingCartOffcanvasLabel">
  <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="shoppingCartOffcanvasLabel">Seu Carrinho</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
      <div class="cart-items-container">
          <% 
            const currentCart = typeof cart !== 'undefined' && Array.isArray(cart) ? cart : [];
            const currentCartTotal = typeof cartTotal !== 'undefined' ? cartTotal : 0;
          %>

          <% if (!currentCart.length) { %>
            <p class="text-muted">Seu carrinho está vazio.</p>
          <% } else { %>
            <% currentCart.forEach(function(item) { %>
              <div class="cart-item-offcanvas">
                  <% if (item.caminho_foto) { %>
                    <img src="<%= item.caminho_foto %>" alt="<%= item.nome %>" class="cart-item-img-offcanvas">
                  <% } %>
                  <div class="item-details">
                      <h6><%= item.nome %></h6>
                      <div class="text-muted">
                        <%= item.quantidade %> x 
                        <span class="price-highlight">R$ <%= Number(item.preco).toFixed(2).replace('.', ',') %></span>
                      </div>
                  </div>
              </div>
            <% }) %>
          <% } %>
      </div>
      <div class="offcanvas-footer">
          <div class="d-flex justify-content-between h5">
              <span>Subtotal</span>
              <strong class="price-highlight" id="cartSubtotal">R$ <%= Number(currentCartTotal).toFixed(2).replace('.', ',') %></strong>
          </div>
          <p class="text-muted small">Taxas e frete serão calculados no checkout.</p>
          <div class="d-grid gap-2">
              <a href="/carrinho" class="btn btn-warning-custom">Ver Carrinho</a>
              <form action="/carrinho/confirmar" method="POST">
                <button type="submit" class="btn btn-secondary w-100">Finalizar Compra</button>
              </form>
          </div>
      </div>
  </div>
</div>

<!-- Modal de Detalhes da Venda -->
<div class="modal fade" id="saleDetailsModal" tabindex="-1" aria-labelledby="saleDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header border-secondary">
        <h5 class="modal-title" id="saleDetailsModalLabel">Detalhes da Venda</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3 d-flex justify-content-between">
          <div>
            <p class="mb-1"><strong>ID da Venda:</strong> <span id="saleDetailsId">-</span></p>
            <p class="mb-1"><strong>Cliente:</strong> <span id="saleDetailsCliente">-</span></p>
          </div>
          <div class="text-end">
            <p class="mb-1"><strong>Data:</strong> <span id="saleDetailsData">-</span></p>
            <p class="mb-1"><strong>Total:</strong> R$ <span id="saleDetailsTotal">0,00</span></p>
          </div>
        </div>

        <h6 class="mt-3 mb-2">Itens da Compra</h6>
        <div class="table-responsive">
          <table class="table table-dark table-striped align-middle mb-0">
            <thead>
              <tr>
                <th>Jogo</th>
                <th class="text-center">Quantidade</th>
                <th>Preço Unitário</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody id="saleDetailsItensBody">
              <tr>
                <td colspan="4" class="text-center text-muted">Carregando...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="editGameModal" tabindex="-1" aria-labelledby="editGameModalLabel" aria-hidden="true"> 
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header border-secondary">
                <h5 class="modal-title" id="editGameModalLabel">Editar Jogo</h5> 
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editGameForm" action="" method="POST" enctype="multipart/form-data"> 
                    <div class="mb-3">
                        <label for="editGameName" class="form-label">Nome do Jogo</label>
                        <input type="text" class="form-control" id="editGameName" name="gameName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editGameCategory" class="form-label">Categoria</label>
                        <input type="text" class="form-control" id="editGameCategory" name="gameCategory" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editGameStock" class="form-label">Estoque</label>
                            <input type="number" class="form-control" id="editGameStock" name="gameStock" min="0" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editGamePrice" class="form-label">Preço (R$)</label>
                            <input type="number" class="form-control" id="editGamePrice" name="gamePrice" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editGameImage" class="form-label">Foto do Jogo</label>
                        <input type="file" class="form-control bg-secondary text-white" id="editGameImage" name="gameImage" accept="image/*">
                    </div>
                    <div class="modal-footer border-top-0 d-flex justify-content-end pt-0 px-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                       <button type="submit" class="btn btn-danger">Salvar Alterações</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<style>
/* Estilo para a Sidebar do Carrinho (Offcanvas) */
.offcanvas {
    background-color: #1a1a1a;
    color: #f8f9fa;
    border-left: 1px solid #495057;
}

/* NOVA CLASSE DE DESTAQUE DE PREÇO */
.price-highlight {
    color: var(--green-accent);
    font-weight: 700; /* Fonte mais forte */
    background-color: rgb(255, 0, 0); /* Fundo verde sutil */
    padding: 2px 6px; /* Espaçamento interno */
    border-radius: 4px; /* Bordas arredondadas */
    display: inline-block; /* Garante que o padding e background funcionem bem */
}

.offcanvas-header {
    border-bottom: 1px solid #495057;
}
.offcanvas-body {
    display: flex;
    flex-direction: column;
    padding: 0;
}
.cart-items-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 1.5rem;
}
.cart-item-offcanvas {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-bottom: 1rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid #343a40;
}
.cart-item-offcanvas:last-child {
    border-bottom: none;
    margin-bottom: 0;
}
.cart-item-img-offcanvas {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 0.25rem;
}
.item-details h6 {
    margin-bottom: 0.25rem;
}
.offcanvas-footer {
    padding: 1.5rem;
    border-top: 1px solid #495057;
    background-color: #1a1a1a;
}
.btn-warning-custom {
    background-color: #ffc107;
    border-color: #ffc107;
    color: #1a1a1a;
    font-weight: bold;
}
.btn-warning-custom:hover {
    background-color: #ffca2c;
    border-color: #ffca2c;
    color: #1a1a1a;
}
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const rentalModal = document.getElementById('registerRentalModal');
        const saleModal = document.getElementById('registerSaleModal');
        const setTodayDate = (modalElement, inputId) => {
            if (modalElement) {
                modalElement.addEventListener('show.bs.modal', function () {
                    const dateInput = modalElement.querySelector(inputId);
                    if (dateInput) {
                        dateInput.value = new Date().toISOString().split('T')[0];
                    }
                });
            }
        };
        setTodayDate(rentalModal, '#rentalDate');
        setTodayDate(saleModal, '#saleDate');

        // Carrinho - interceptar formulários de adicionar ao carrinho
        const addToCartForms = document.querySelectorAll('form.add-to-cart-form');
        const cartOffcanvasEl = document.getElementById('shoppingCartOffcanvas');
        const cartItemsContainer = document.querySelector('.cart-items-container');
        const cartSubtotalEl = document.getElementById('cartSubtotal');

        function formatPrice(value) {
            return value.toFixed(2).replace('.', ',');
        }

        function updateCartOffcanvas(cart, total) {
            if (!cartItemsContainer) return;

            cartItemsContainer.innerHTML = '';

            if (!cart || !cart.length) {
                cartItemsContainer.innerHTML = '<p class="text-muted">Seu carrinho está vazio.</p>';
            } else {
                cart.forEach(function (item) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'cart-item-offcanvas';

                    if (item.caminho_foto) {
                        const img = document.createElement('img');
                        img.src = item.caminho_foto;
                        img.alt = item.nome;
                        img.className = 'cart-item-img-offcanvas';
                        wrapper.appendChild(img);
                    }

                    const details = document.createElement('div');
                    details.className = 'item-details';
                    const title = document.createElement('h6');
                    title.textContent = item.nome;
                    details.appendChild(title);

                    const info = document.createElement('div');
                    info.className = 'text-muted';
                    info.innerHTML = `${item.quantidade} x <span class="price-highlight">R$ ${formatPrice(Number(item.preco))}</span>`;
                    details.appendChild(info);

                    wrapper.appendChild(details);
                    cartItemsContainer.appendChild(wrapper);
                });
            }

            if (cartSubtotalEl) {
                cartSubtotalEl.textContent = `R$ ${formatPrice(Number(total || 0))}`;
            }
        }

        if (addToCartForms && cartOffcanvasEl) {
            addToCartForms.forEach(function (form) {
                form.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const action = form.action;

                    fetch(action, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                        .then(function (res) { return res.json(); })
                        .then(function (data) {
                            updateCartOffcanvas(data.cart, data.total);

                            const offcanvas = bootstrap.Offcanvas.getOrCreateInstance(cartOffcanvasEl);
                            offcanvas.show();
                        })
                        .catch(function (err) {
                            console.error('Erro ao adicionar ao carrinho:', err);
                        });
                });
            });
        }

        // Detalhes da venda (tela admin/vendas)
        const saleDetailsModalEl = document.getElementById('saleDetailsModal');
        const saleDetailsIdEl = document.getElementById('saleDetailsId');
        const saleDetailsClienteEl = document.getElementById('saleDetailsCliente');
        const saleDetailsDataEl = document.getElementById('saleDetailsData');
        const saleDetailsTotalEl = document.getElementById('saleDetailsTotal');
        const saleDetailsItensBodyEl = document.getElementById('saleDetailsItensBody');

        function formatPrice(value) {
            return value.toFixed(2).replace('.', ',');
        }

        const detailIcons = document.querySelectorAll('.sale-view-details');
        detailIcons.forEach(function (icon) {
            icon.addEventListener('click', function () {
                const saleId = icon.getAttribute('data-sale-id');
                if (!saleId) return;

                if (saleDetailsItensBodyEl) {
                    saleDetailsItensBodyEl.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Carregando...</td></tr>';
                }

                fetch(`/vendas/${saleId}`, {
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (saleDetailsIdEl) saleDetailsIdEl.textContent = data.id;
                        if (saleDetailsClienteEl) saleDetailsClienteEl.textContent = data.cliente_nome;
                        if (saleDetailsDataEl) saleDetailsDataEl.textContent = data.data;
                        if (saleDetailsTotalEl) saleDetailsTotalEl.textContent = formatPrice(Number(data.total || 0));

                        if (saleDetailsItensBodyEl) {
                            saleDetailsItensBodyEl.innerHTML = '';

                            if (!data.itens || !data.itens.length) {
                                saleDetailsItensBodyEl.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum item encontrado.</td></tr>';
                            } else {
                                data.itens.forEach(function (item) {
                                    const tr = document.createElement('tr');
                                    const subtotal = Number(item.preco || 0) * Number(item.quantidade || 0);

                                    tr.innerHTML = `
                                        <td>${item.nome || '-'}</td>
                                        <td class="text-center">${item.quantidade || 0}</td>
                                        <td>R$ ${formatPrice(Number(item.preco || 0))}</td>
                                        <td>R$ ${formatPrice(subtotal)}</td>
                                    `;

                                    saleDetailsItensBodyEl.appendChild(tr);
                                });
                            }
                        }

                        if (saleDetailsModalEl) {
                            const modalInstance = bootstrap.Modal.getOrCreateInstance(saleDetailsModalEl);
                            modalInstance.show();
                        }
                    })
                    .catch(function (err) {
                        console.error('Erro ao carregar detalhes da venda:', err);
                    });
            });
        });

        // Exclusão de venda
        const deleteIcons = document.querySelectorAll('.sale-delete');
        deleteIcons.forEach(function (icon) {
            icon.addEventListener('click', function () {
                const saleId = icon.getAttribute('data-sale-id');
                if (!saleId) return;

                const confirmar = window.confirm('Tem certeza que deseja excluir esta venda?');
                if (!confirmar) return;

                fetch(`/vendas/${saleId}/deletar`, {
                    method: 'POST',
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                        if (data && data.sucesso) {
                            // Remove a linha da tabela sem recarregar
                            const row = icon.closest('tr');
                            if (row) row.remove();
                        }
                    })
                    .catch(function (err) {
                        console.error('Erro ao excluir venda:', err);
                    });
            });
        });
    });
</script>